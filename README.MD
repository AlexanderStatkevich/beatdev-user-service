# User-Service

## Test task for Beatdev

### Использованный стэк

* Java 8
* Spring Boot 2.7.10
* MySql
* Gradle 7.6
* Flyway
* Docker
* Swagger
* Springdoc
* JUnit
* Mockito
* AssertJ
* Testcontainers

### Описание проекта

Приложение отвечает всем заявленным требованиям:

 ```sh
    Создать функционал (запросы):
1. Добавление нового пользователя.
- Передаем на сервер персональные данные пользователя (URI картинки, имя пользователя, emailи т.д.).
- Сохраняем информацию в базе данных.
- Ответ сервера — уникальный ID нового пользователя.
2. Получение информации о пользователе.
- Передаем на сервер уникальный ID пользователя.
- Читаем информацию из базы данных.
- Ответ сервера — персональные данные пользователя (см. выше).
3. Изменение статуса пользователя (Online, Offline).
- Передаем на сервер уникальный ID пользователя и новый статус (Online, Offline).
- Изменяем статус пользователя.
- Ответ сервера — уникальный ID пользователя, новый и предыдущий статус.
  ```

Краткое описание применённых технологий:

* Flyway - инструмент миграций баз данных, для выполнения DDL операций после запуска приложения.
* Docker - средство контейнеризации, позволяет развернуть приложение без окружения, имея только докер-образы.
* С помощью Swagger и Springdoc добавлена функция "generateOpenApiDocs", которая позволяет сгенерировать OpenApi файл,
  также этот файл можно увидеть на запущеном приложении по адресу

```sh
http://${HOST}/swagger-ui/index.html

HOST - адрес на котором запущено приложение, на локальной машине "localhost" или "127.0.0.1".
  ```

* JUnit, Mockito, AssertJ, Testcontainers использованы для написания тестов. Выполнение тестов, которые используют
  библеотеку Testcontainers, требует
  запущенный Docker. Так как приложение не содержит большого количества логики, тесты имеют показательный характер, для
  описания возможностей библиотек.

### Инструкция по запуску приложения в Docker

Для запуска необходимо произвести установку программы Docker и сборку проекта по инструкции по базовому запуску
используя предустановленные настройки в application.yml файле,
однако сборку произвести командой:

 ```sh
gradle build -x :test
  ```

так как при настройках базы данных, которая впоследствие будет развернута в докер контейнере невозможно выполнить тесты.
Далее для запуска необходим файл docker-compose.yml из проекта. Развернуть проект можно следующей командой находясь в
директории проекта:

 ```sh
docker compose up
  ```

Данная команда с помощью докерфайла соберет приложение и запустит базу данных с помощью образа СУБД MySql.
Образы будут подняты в виртуальной машине, предоставляя доступ к приложению по 80 порту и хосту "localhost",
если образ развернут на локальной машине.

### Инструкция по запуску базовой версии

Для работы приложения необходимо иметь окружение для компиляции и запуска Java приложений,
установить СУБД MySql, создать базу данных и настроить подключение передав в application.yml
параметры для DataSource:

 ```sh
datasource:
url: jdbc:mysql://${PORT}:${PORT}/${DB_NAME}
username: ${USERNAME}
password: ${PASSWORD}
  ```

HOST - адрес на котором запущена база данных, на локальной машине "localhost" или "127.0.0.1".
PORT - порт для подключения к базе данных, по умолчанию для MySQL 3306.
DB-NAME - название созданной базы данных.
USERNAME, PASSWORD - логин и пароль соответственно для подключения к базе данных.

Также необходимо собрать проект с помощью сборщика Gradle в .jar архив следующей командой, находясь в директории
проекта:

 ```sh
gradle build
  ```

Далее запустить собранный jar архив из терминала:

  ```sh
java -jar jar_name.jar 
  ```

При запуске на локальной машине приложение будет доступно по 80 порту.

### Описание эндпойнтов:

* /users

Для добавление нового пользователя необходимо отправить запрос:

 ```sh
 (POST) http://host:80/users
  ```

с объектом в формате JSON нижеприведенного типа:

 ```sh
{
    "email": "example@smth.org",
    "fullName": "Example Example",
    "imageUri": "smth",
    "status": "ONLINE",
    "password": "1111"
}
  ```

запрос возвращает уникальный id созданного пользователя.

* /users/{id}

Для получение пользователя по id необходимо отправить запрос:

 ```sh
(GET) http://host:80/users/{id}
  ```

запрос возвращает объект в формате JSON, который возвращается из базы данных, пример ниже:

 ```sh
{
"id": 1,
"email": "example@smth.org",
"status": "ONLINE",
"date_time_create": "2023-04-09T22:42:21.045",
"date_time_update": "2023-04-09T22:42:21.045",
"full_name": "Example Example",
"image_uri": "smth"
}
  ```

Для изменение статуса пользователя необходимо отправить запрос:

 ```sh
(PATCH) http://host:80/users/{id}
  ```

с объектом в формате JSON нижеприведенного типа, принимает значения поля "status" только "ONLINE" или "OFFLINE":

 ```sh
{
    "status": "OFFLINE"
}
  ```
  запрос возвращает объект в формате JSON, который содержит id измененного пользователя, текущее и предыдущее состояние, пример ниже:

 ```sh
{
    "id": 2,
    "current_status": "OFFLINE",
    "previous_status": "ONLINE"
}
  ```


### Затраченное время:

* проектирование около 30 минут
* программирование базовой версии сервиса заняло около 2-3 часов
* документация около 1-1,5 часа
* больше всего времени понадобилось на дополнительные библиотеки, также на освоение особенностей СУБД MySQL(ранее
  работал с PostgreSQL)
  и некоторые несовместимости Docker и СУБД, в сумме 8-10 часов
* написание тестов 2-3 часа

## Контакты

Alexander Statkevich - aastatkevich@gmail.com

<p align="right">(<a href="#readme-top">back to top</a>)</p>
